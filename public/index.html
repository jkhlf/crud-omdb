<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>Sistema de Vota√ß√£o - Filmes e S√©ries</title>
    <style>
        :root {
            --background-dark: #1e1a26;
            --background-light: #2b2735;
            --primary-purple: #7b4397;
            --primary-purple-light: #9f58c7;
            --text-primary: #f1f1f1;
            --text-secondary: #a0a0a0;
            --border-color: #3c354a;
            --red: #e53935;
            --green: #43a047;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Arial', sans-serif;
            background-color: var(--background-dark);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: var(--background-light);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #3498db;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .filmes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .filme-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .filme-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .filme-content {
            padding: 20px;
        }

        .filme-title {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .filme-genre {
            color: #666;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .filme-description {
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }

        .vote-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .vote-buttons {
            display: flex;
            gap: 10px;
        }

        .vote-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .vote-btn.like {
            background: #27ae60;
            color: white;
        }

        .vote-btn.like:hover {
            background: #229954;
        }

        .vote-btn.dislike {
            background: #e74c3c;
            color: white;
        }

        .vote-btn.dislike:hover {
            background: #c0392b;
        }

        .vote-count {
            font-size: 0.9em;
            color: #666;
        }

        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .submit-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .omdb-results {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background: white;
        }

        .omdb-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .omdb-item:hover {
            background: #f8f9fa;
        }

        .omdb-item:last-child {
            border-bottom: none;
        }

        .omdb-poster {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 3px;
        }

        .omdb-info h4 {
            margin: 0;
            color: #2c3e50;
        }

        .omdb-info p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 0.9em;
        }

        .use-omdb-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .dashboard-container {
            padding: 20px;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .dashboard-card.likes {
            background:  #27ae60;
            color: white;
        }

        .dashboard-card.dislikes {
            background: #e74c3c;
            color: white;
        }

        .dashboard-card.movies {
            background: #3498db;
            color: white;
        }

        .dashboard-card.reviews {
            background: #f39c12;
            color: white;
        }

        .card-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .card-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .card-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .dashboard-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .chart-container, .top-filmes {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .chart-container h3, .top-filmes h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            text-align: center;
        }

        .progress-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .progress-label {
            min-width: 100px;
            font-weight: bold;
            color: #2c3e50;
        }

        .progress-bar {
            flex: 1;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }

        .progress-fill.positive {
            background:  #2ecc71;
        }

        .progress-fill.negative {
            background: #e74c3c;
        }

        .progress-percent {
            min-width: 40px;
            font-weight: bold;
            color: #2c3e50;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .ranking-item:hover {
            background: #e9ecef;
        }

        .ranking-position {
            font-size: 1.2em;
            font-weight: bold;
            color: #f39c12;
            min-width: 30px;
        }

        .ranking-info {
            flex: 1;
            margin-left: 10px;
        }

        .ranking-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .ranking-votes {
            font-size: 0.9em;
            color: #666;
        }

        .ranking-score {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
        }

        .ranking-score.positive {
            background: #27ae60;
        }

        .ranking-score.negative {
            background: #e74c3c;
        }

        .ranking-score.neutral {
            background: #95a5a6;
        }

        @media (max-width: 768px) {
            .dashboard-charts {
                grid-template-columns: 1fr;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <main class="container">
        <header class="header">
            <h1>Sistema de Vota√ß√£o</h1>
            <p>Vote nos seus filmes e s√©ries favoritos!</p>
        </header>

        <nav class="tabs">
            <button class="tab" onclick="showTab('dashboard')">Dashboard</button>
            <button class="tab active" onclick="showTab('filmes')">Filmes & S√©ries</button>
            <button class="tab" onclick="showTab('cadastro')">Cadastrar</button>
        </nav>

        <section id="dashboard-tab" class="tab-content">
            <div class="dashboard-container">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Estat√≠sticas Gerais</h2>

                <div class="dashboard-stats">
                    <div class="dashboard-card likes">
                        <div class="card-icon">üëç</div>
                        <div class="card-content">
                            <div class="card-number" id="dashboard-positivos">0</div>
                            <div class="card-label">Gostei</div>
                        </div>
                    </div>

                    <div class="dashboard-card dislikes">
                        <div class="card-icon">üëé</div>
                        <div class="card-content">
                            <div class="card-number" id="dashboard-negativos">0</div>
                            <div class="card-label">N√£o Gostei</div>
                        </div>
                    </div>

                    <div class="dashboard-card movies">
                        <div class="card-icon">üé¨</div>
                        <div class="card-content">
                            <div class="card-number" id="dashboard-filmes">0</div>
                            <div class="card-label">Filmes & S√©ries</div>
                        </div>
                    </div>

                    <div class="dashboard-card reviews">
                        <div class="card-icon">‚≠ê</div>
                        <div class="card-content">
                            <div class="card-number" id="dashboard-total-reviews">0</div>
                            <div class="card-label">Total de Reviews</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-charts">
                    <div class="chart-container">
                        <h3>üìä Distribui√ß√£o de Votos</h3>
                        <div class="progress-chart">
                            <div class="progress-item">
                                <span class="progress-label">üëç Positivos</span>
                                <div class="progress-bar">
                                    <div class="progress-fill positive" id="progress-positivos" style="width: 0%"></div>
                                </div>
                                <span class="progress-percent" id="percent-positivos">0%</span>
                            </div>
                            <div class="progress-item">
                                <span class="progress-label">üëé Negativos</span>
                                <div class="progress-bar">
                                    <div class="progress-fill negative" id="progress-negativos" style="width: 0%"></div>
                                </div>
                                <span class="progress-percent" id="percent-negativos">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="top-filmes">
                        <h3>üèÜ Top Filmes/S√©ries</h3>
                        <div id="ranking-filmes">
                            <div class="loading">Carregando ranking...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="filmes-tab" class="tab-content active">
            <div id="filmes-container">
                <div class="loading">Carregando filmes...</div>
            </div>
        </section>

        <section id="cadastro-tab" class="tab-content">
            <div class="form-container">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">Cadastrar Novo Filme/S√©rie</h2>

                <div class="form-group">
                    <label for="busca-omdb">Buscar filme/s√©rie online:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="busca-omdb" placeholder="Digite o nome do filme ou s√©rie...">
                        <button type="button" onclick="buscarOMDB()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">Buscar</button>
                    </div>
                </div>

                <div id="resultados-omdb" style="margin-bottom: 20px;"></div>

                <form id="filme-form">
                    <div class="form-group">
                        <label for="titulo">T√≠tulo</label>
                        <input type="text" id="titulo" name="titulo" required>
                    </div>

                    <div class="form-group">
                        <label for="genero">G√™nero</label>
                        <select id="genero" name="genero" required>
                            <option value="">Selecione um g√™nero</option>
                            <option value="A√ß√£o">A√ß√£o</option>
                            <option value="Aventura">Aventura</option>
                            <option value="Com√©dia">Com√©dia</option>
                            <option value="Drama">Drama</option>
                            <option value="Fic√ß√£o Cient√≠fica">Fic√ß√£o Cient√≠fica</option>
                            <option value="Horror">Horror</option>
                            <option value="Romance">Romance</option>
                            <option value="Suspense">Suspense</option>
                            <option value="Fantasia">Fantasia</option>
                            <option value="Document√°rio">Document√°rio</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="imagem">URL da Imagem</label>
                        <input type="url" id="imagem" name="imagem" placeholder="https://exemplo.com/imagem.jpg">
                    </div>

                    <div class="form-group">
                        <label for="descricao">Descri√ß√£o</label>
                        <textarea id="descricao" name="descricao" placeholder="Breve descri√ß√£o do filme ou s√©rie..."></textarea>
                    </div>

                    <button type="submit" class="submit-btn">Cadastrar</button>
                </form>

                <div id="form-message"></div>
            </div>
        </section>
    </main>

    <script>
        const API_URL = '/api';
        let filmesData = [];
        let dadosOMDBSelecionado = null;

        document.addEventListener('DOMContentLoaded', function() {
            showTab('filmes');
            carregarFilmes();
            carregarDashboard();

            document.getElementById('filme-form').addEventListener('submit', cadastrarFilme);

            const buscaInput = document.getElementById('busca-omdb');
            if (buscaInput) {
                buscaInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        buscarOMDB();
                    }
                });
            }
        });

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            const activeTabButton = document.querySelector(`button[onclick="showTab('${tabName}')"]`);
            if(activeTabButton) activeTabButton.classList.add('active');

            const activeTabContent = document.getElementById(tabName + '-tab');
            if(activeTabContent) activeTabContent.classList.add('active');

            if (tabName === 'dashboard') {
                carregarDashboard();
            }
            if (tabName === 'filmes') {
                renderizarFilmes();
            }
        }

        async function carregarDashboard() {
            try {
                const totaisResponse = await fetch(`${API_URL}/votos/totais`);
                const totais = await totaisResponse.json();

                const filmesResponse = await fetch(`${API_URL}/filmes`);
                const filmes = await filmesResponse.json();
                filmesData = filmes;

                atualizarDashboard(totais, filmes);
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
            }
        }

        function atualizarDashboard(totais, filmes) {
            const totalReviews = totais.positivos + totais.negativos;

            document.getElementById('dashboard-positivos').textContent = totais.positivos;
            document.getElementById('dashboard-negativos').textContent = totais.negativos;
            document.getElementById('dashboard-filmes').textContent = filmes.length;
            document.getElementById('dashboard-total-reviews').textContent = totalReviews;

            if (totalReviews > 0) {
                const percentPositivos = (totais.positivos / totalReviews * 100).toFixed(1);
                const percentNegativos = (totais.negativos / totalReviews * 100).toFixed(1);

                document.getElementById('progress-positivos').style.width = percentPositivos + '%';
                document.getElementById('progress-negativos').style.width = percentNegativos + '%';
                document.getElementById('percent-positivos').textContent = percentPositivos + '%';
                document.getElementById('percent-negativos').textContent = percentNegativos + '%';
            } else {
                document.getElementById('progress-positivos').style.width = '0%';
                document.getElementById('progress-negativos').style.width = '0%';
                document.getElementById('percent-positivos').textContent = '0%';
                document.getElementById('percent-negativos').textContent = '0%';
            }

            atualizarRanking(filmes);
        }

        function atualizarRanking(filmes) {
            const rankingContainer = document.getElementById('ranking-filmes');
            if (!rankingContainer) return;

            if (filmes.length === 0) {
                rankingContainer.innerHTML = '<p style="text-align: center; color: #666;">Nenhum filme cadastrado</p>';
                return;
            }

            const filmesComScore = filmes.map(filme => ({
                ...filme,
                score: filme.gostei - filme.nao_gostei,
                totalVotos: filme.gostei + filme.nao_gostei
            }));

            filmesComScore.sort((a, b) => {
                if (b.score === a.score) {
                    return b.totalVotos - a.totalVotos;
                }
                return b.score - a.score;
            });

            const top5 = filmesComScore.slice(0, 5);

            const rankingHTML = top5.map((filme, index) => {
                let scoreClass = 'neutral';
                if (filme.score > 0) scoreClass = 'positive';
                else if (filme.score < 0) scoreClass = 'negative';

                let medal = '';
                if (index === 0) medal = 'ü•á';
                else if (index === 1) medal = 'ü•à';
                else if (index === 2) medal = 'ü•â';
                else medal = `${index + 1}¬∞`;

                return `
                    <div class="ranking-item">
                        <div class="ranking-position">${medal}</div>
                        <div class="ranking-info">
                            <div class="ranking-title">${filme.titulo}</div>
                            <div class="ranking-votes">üëç ${filme.gostei} ‚Ä¢ üëé ${filme.nao_gostei}</div>
                        </div>
                        <div class="ranking-score ${scoreClass}">
                            ${filme.score > 0 ? '+' : ''}${filme.score}
                        </div>
                    </div>
                `;
            }).join('');

            rankingContainer.innerHTML = rankingHTML;
        }

        async function carregarFilmes() {
            try {
                const response = await fetch(`${API_URL}/filmes`);
                if (!response.ok) throw new Error('Erro ao carregar filmes');

                filmesData = await response.json();
                renderizarFilmes();
            } catch (error) {
                console.error('Erro:', error);
                const container = document.getElementById('filmes-container');
                if (container) {
                    container.innerHTML =
                        '<div class="error">Erro ao carregar filmes. Tente novamente mais tarde.</div>';
                }
            }
        }

        function renderizarFilmes() {
            const container = document.getElementById('filmes-container');
            if (!container) return;

            if (filmesData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum filme cadastrado ainda.</p>';
                return;
            }

         const filmesHTML = filmesData.map(filme => `
                <div class="filme-card">
                    <img src="${filme.imagem || 'https://via.placeholder.com/300x320?text=Sem+Imagem'}"
                         alt="${filme.titulo}" class="filme-image"
                         onerror="this.src='https://via.placeholder.com/300x320?text=Sem+Imagem'">
                    <div class="filme-content">
                        <div class="filme-title">${filme.titulo}</div>
                        <div class="filme-genre">${filme.genero}</div>
                        <div class="filme-description">${filme.descricao || ''}</div>
                        <div class="vote-section">
                            <div class="vote-buttons">
                                <button class="vote-btn like" onclick="votar(${filme.id}, 'gostei')">
                                    Gostei
                                </button>
                                <button class="vote-btn dislike" onclick="votar(${filme.id}, 'nao_gostei')">
                                    N√£o Gostei
                                </button>
                            </div>
                            <div class="vote-count">
                                üëç ${filme.gostei} üëé ${filme.nao_gostei}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `<div class="filmes-grid">${filmesHTML}</div>`;
        }

        async function votar(filmeId, tipo) {
            try {
                const response = await fetch(`${API_URL}/filmes/${filmeId}/voto`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        tipo
                    })
                });

                if (!response.ok) throw new Error('Erro ao registrar voto');

                await carregarDashboard();
                renderizarFilmes();

            } catch (error) {
                console.error('Erro ao votar:', error);
                alert('Erro ao registrar voto. Tente novamente.');
            }
        }

        async function buscarOMDB() {
            const termo = document.getElementById('busca-omdb').value.trim();
            const resultadosDiv = document.getElementById('resultados-omdb');

            if (!termo) {
                alert('Digite um termo para buscar');
                return;
            }

            resultadosDiv.innerHTML = '<div class="loading">Buscando filmes...</div>';

            try {
                const response = await fetch(`${API_URL}/omdb/buscar/${encodeURIComponent(termo)}`);
                if (!response.ok) throw new Error('Erro na busca');

                const data = await response.json();

                if (!data.filmes || data.filmes.length === 0) {
                    resultadosDiv.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Nenhum filme encontrado. Tente outro termo.</div>';
                    return;
                }

                const resultadosHTML = data.filmes.map(filme => `
                    <div class="omdb-item" onclick="selecionarFilmeOMDB('${filme.imdbID}', '${filme.titulo.replace(/'/g, "\\'")}')">
                        <img src="${filme.imagem || 'https://via.placeholder.com/60x80?text=Sem+Imagem'}"
                             alt="${filme.titulo}" class="omdb-poster"
                             onerror="this.src='https://via.placeholder.com/60x80?text=Sem+Imagem'">
                        <div class="omdb-info">
                            <h4>${filme.titulo}</h4>
                            <p>${filme.ano} ‚Ä¢ ${filme.tipo === 'movie' ? 'Filme' : 'S√©rie'}</p>
                        </div>
                        <button class="use-omdb-btn">Usar este</button>
                    </div>
                `).join('');

                resultadosDiv.innerHTML = `<div class="omdb-results"><h3>Resultados encontrados:</h3>${resultadosHTML}</div>`;
            } catch (error) {
                console.error('Erro ao buscar no OMDB:', error);
                resultadosDiv.innerHTML = '<div class="error">Erro ao buscar filmes. Tente novamente.</div>';
            }
        }

        async function selecionarFilmeOMDB(imdbID, titulo) {
            try {
                const response = await fetch(`${API_URL}/omdb/search/${encodeURIComponent(titulo)}`);
                if (!response.ok) throw new Error('Erro ao buscar detalhes');

                const filme = await response.json();
                dadosOMDBSelecionado = filme;

                document.getElementById('titulo').value = filme.titulo || '';

                const generoSelect = document.getElementById('genero');
                const primeiroGenero = filme.genero ? filme.genero.split(',')[0].trim() : '';
                let optionExists = [...generoSelect.options].some(option => option.value === primeiroGenero);
                if(optionExists) {
                    generoSelect.value = primeiroGenero;
                } else {
                    generoSelect.value = "";
                }

                document.getElementById('imagem').value = filme.imagem || '';
                document.getElementById('descricao').value = filme.descricao || '';

                document.getElementById('resultados-omdb').innerHTML =
                    `<div class="success">Filme "${filme.titulo}" selecionado! Voc√™ pode editar os campos abaixo antes de cadastrar.</div>`;

            } catch (error) {
                console.error('Erro ao selecionar filme:', error);
                alert('Erro ao carregar detalhes do filme.');
            }
        }

        async function cadastrarFilme(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const filmeData = {
                titulo: formData.get('titulo'),
                genero: formData.get('genero'),
                imagem: formData.get('imagem'),
                descricao: formData.get('descricao'),
                omdbData: dadosOMDBSelecionado
            };

            try {
                const response = await fetch(`${API_URL}/filmes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(filmeData)
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Erro ao cadastrar filme');
                }

                const novoFilme = await response.json();

                filmesData.push(novoFilme);

                event.target.reset();
                dadosOMDBSelecionado = null;
                document.getElementById('busca-omdb').value = '';
                document.getElementById('resultados-omdb').innerHTML = '';

                const formMessage = document.getElementById('form-message');
                formMessage.innerHTML =
                    '<div class="message success">Filme cadastrado com sucesso!</div>';

                await carregarDashboard();
                renderizarFilmes();

                setTimeout(() => {
                    formMessage.innerHTML = '';
                    const tabButton = document.querySelector('button[onclick="showTab(\'filmes\')"]');
                    if (tabButton) tabButton.click();
                }, 2000);

            } catch (error) {
                console.error('Erro ao cadastrar:', error);
                document.getElementById('form-message').innerHTML =
                    `<div class="message error">Erro ao cadastrar filme: ${error.message}.</div>`;
            }
        }
    </script>
</body>
</html>
